<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>review</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"
    />


  </head>
  <body>

    <div class="w-full py-6 space-y-6 md:py-12">
      <div class="container space-y-6 px-4 md:px-6">

        <div class="grid gap-6 md:gap-8 lg:grid-cols-12 lg:gap-12">
          <div class="flex items-center space-x-4 lg:col-span-3">
            {# 포스터사진 {{ post_id }}#}
            <img
              src="static/images/movies/{{ post_id }}/poster/poster.jpg"
              alt="Poster"
              style="width: 300px; height: 400px; object-fit: fill; border-radius: 10px"
            />

          </div>
          {# 영화별#}
          <div class="grid gap-2 lg:col-span-9">
            <div class="space-y-2">
              <h1 class="text-3xl font-bold tracking-tighter sm:text-5xl">
                {{ title }}
              </h1>
                <div style="display: flex">
              <p class="text-gray-500 dark:text-gray-400">{{ genres }}</p>
                </div>
            </div>

            <div
              class="grid md:grid-cols-2 md:gap-4 lg:grid-cols-1fr_2fr lg:gap-0"
            >
              {# director#}

              <dl class="grid gap-1">

                  <dt style=" font-weight: bold;">감독  </dt>
                  <dt class="grid gap-1">
                     {{ director }}
                  </dt>
{#                  img태그로 감독사진 넣기#}

              </dl>
                <dl>
                    <dt class="grid gap-1">
{##                       flask에서 반복문#}
                        추천작품

                    </dt>
                <dt >
                    {{ recommend }}

                </dt>
                </dl>
                    <img
                            src="static/images/movies/{{ post_id }}/director/{{ post_id }}_director.jpg"
                            alt="Poster"
                            style="width: 150px; height: 250px; object-fit: fill;"
                    />


            </div>
          </div>
        </div>
        <div class="grid gap-4 lg:grid-cols-12 lg:gap-8">
          <div class="space-y-2 lg:col-span-3">
            <h3
              class="text-xl font-bold tracking-tighter sm:text-2xl md:text-3xl"
            >
              캐스팅
            </h3>
          </div>
          {#배우사진#}

          <div class="grid gap-4 lg:col-span-10 lg:grid-cols-4">
            {# 반복문으로?#} {# 1번#} {# 영화배우들이 있는 actors 파일에서
            1_1이미지나 #} {% for i in range(1, file_count+1) %}
            <div>
              {# 배우는 1_1.jpg형식으로 저장됨#} {# 어떤 폴더에서 특정배우
              이미지를 가져오려면?#} {# div 사이즈어디까지 인지#}
              <div
                style="
                  height: 200px;
                  width: 200px;
                  padding: 1px;
                  border: 3px;
                  solid: black;
                "
              >
                {# 이미지 크기가 전부 다른데 이걸 한가지로 고정#}
                <img
                  src="static/images/movies/{{ post_id }}/actors/{{ post_id }}_{{ i }}.jpg"
                  alt="Actor"
                  class="rounded-xl object-fill object-center w-full h-full"
                />
              </div>
              {# 이름은 리스트에 저장되어있으니까 인덱스로 접근#}
              <div class="space-y-1">
                <h4 class="font-semibold">{{ actors[i-1] }}</h4>
              </div>
            </div>
            {% endfor %}
            <div>{# 2번#}</div>
          </div>
        </div>

        {# 내용 #} {# 전체 차지하는길이 lg:grid-cols-12 #}
        <div class="grid gap-4 lg:grid-cols-12 lg:gap-8">
          {# 하위에서 차지하는 부분 정하는게 lg:col-span-12 #}
          <div class="space-y-2 lg:col-span-12">
            <h3
              class="text-xl font-bold tracking-tighter sm:text-2xl md:text-3xl"
            >
              줄거리
            </h3>

            <p>{{ summary }}</p>
          </div>
        </div>
        {# 위아래로 말고 양옆으로 표출할때는 display 속성#} {#리뷰가 먼저
        나오는게 좋을지 아니면 워드클라우드가 먼저 나오는게 좋을지 배치#}

        <div
          class="positive_field"
          style="width: 100%; display: flex; align-items: center"
        >
            <div
                    class="positive_review_container"
                    style=" display: flex; flex-direction: column"
            >
                <h3
                        class="text-xl font-bold tracking-tighter sm:text-2xl md:text-3xl"
                >
                    긍정워드클라우드
                </h3>
                <br>
          <img
            src="static/images/movies/{{ post_id }}/positive_wordcloud.jpg"
            alt="Positive Word Cloud"
            style="width: 300px; height: 300px; margin-right: 30px"
          />


{#            긍정워드클라우드#}
<</div>
            <div>
                <pre>  </pre>
            </div>
          <div
            class="positive_review_container"
            style="width: 100%; display: flex; flex-direction: column"
          >
            <ul
              class="positive_review_list"
              style="
                display: flex;
                flex-direction: column;
                justify-content: flex-start;
                height: 500px;
                border: 1px solid black;
                border-radius: 10px;
                overflow-y: auto;
              "
            ></ul>
            <div
              class="button_container"
              style="
                display: flex;
                justify-content: center;
                gap: 30px;
                margin-top: 10px;
              "
            >
              <button type="button" id="positiveBeforeButton">
                <img
                  src="static/beforebutton.png"
                  height="50px"
                  width="50px"
                  alt="이전"
                />
              </button>
              <button type="button" id="positiveNextButton">
                <img
                  src="static/nextbutton.png"
                  height="50px"
                  width="50px"
                  alt="다음"
                />
              </button>
            </div>
          </div>
        </div>

{#부정워드클라우드#}
{#          <div#}
{#                  class="negative_field"#}
{#                  style="width: 100%; display: flex; align-items: center; flex-direction: column;"#}
{#          > grid 방식으로는 어렵?#}
        <div
          class="negative_field"
          style="width: 100%; display: flex; align-items: center"
        >

            <div
                    class="positive_review_container"
                    style=" display: flex; flex-direction: column"
            >
                <h3
                        class="text-xl font-bold tracking-tighter sm:text-2xl md:text-3xl"
                >
                    부정워드클라우드
                </h3>
                <br>
          <img
            src="static/images/movies/{{ post_id }}/negative_wordcloud.jpg"
            alt="Negative Word Cloud"
            style="width: 300px; height: 300px; margin-right: 30px"
          />
</div>
            <div>
                <pre>  </pre>
            </div>
          <div
            class="negative_review_container"
            style="width: 100%; display: flex; flex-direction: column"
          >
            <ul
              class="negative_review_list"
              style="
                display: flex;
                flex-direction: column;
                justify-content: flex-start;
                height: 500px;
                border: 1px solid black;
                border-radius: 10px;
                overflow-y: auto;
              "
            ></ul>
            <div
              class="button_container"
              style="
                display: flex;
                justify-content: center;
                gap: 30px;
                margin-top: 10px;
              "
            >
              <button type="button" id="negativeBeforeButton">
                <img
                  src="static/beforebutton.png"
                  height="50px"
                  width="50px"
                  alt="이전"
                />
              </button>
              <button type="button" id="negativeNextButton">
                <img
                  src="static/nextbutton.png"
                  height="50px"
                  width="50px"
                  alt="다음"
                />
              </button>
            </div>
          </div>
        </div>

        <div style="display: flex">
          <span
            style="
              color: black;
              text-align: center;
              font-size: 24px;
              margin-bottom: 10px;
            "
            ><h1 class="text-3xl font-bold tracking-tight">긍정반복</h1>
            <img
              src="static/images/movies/{{ post_id }}/positive.png"
              alt="positive"
              style="width: 500px; height: 300px"
          /></span>

          <span
            style="
              color: black;
              text-align: center;
              font-size: 24px;
              margin-bottom: 10px;
            "
            ><h1 class="text-3xl font-bold tracking-tight">부정반복</h1>
            <img
              src="static/images/movies/{{ post_id }}/negative.png"
              alt="negative"
              style="width: 500px; height: 300px"
          /></span>
        </div>

{#      <div>#}
{#            <div>긍정</div>#}
{#          <span> {{ positive_category_actor[0] }}</span> <br>#}
{#            <span> {{ positive_category_story[0] }}</span> <br>#}
{#            <span> {{ positive_category_directing[0] }}</span>#}
{#      </div>#}
{#      <div>#}
{#          <div>부정</div>#}
{#          <span> {{ negative_category_actor[0] }}</span> <br>#}
{#          <span> {{ negative_category_story[0] }}</span> <br>#}
{#          <span> {{ negative_category_directing[0] }}</span>#}
{#      </div>#}
        {# 카테고리별로 묶었을 때 나오는 리뷰들#} {# 긍정리뷰에서 카테고리가
        story,actor,directing#}
          {# 부정리뷰에서 카테고리가
        story,actor,directing#}
          <h1 class="text-3xl font-bold tracking-tight">Movie categories</h1>
{#      긍정카테고리#}
              <button class="hover:bg-yellow-200 inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3"
                      id="story">
                  각본
              </button>
              <button class="hover:bg-yellow-200 inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3"
                      id="actor">
                  배우
              </button>
              <button
                      class="hover:bg-yellow-200  inline-flex items-center justify-center whitespace-nowrap text-sm font-medium  border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 rounded-md px-3"
                      id="directing">연출
              </button>
{#여기에 이제 카테고리별로 출력#}
{#      카테고리 출력되는 부분#}
          <div
                  class="category_field"
                  style="width: 100%; display: flex; flex-direction: column"
          >
              <ul

                      class="category"
                      style="
                display: flex;
                flex-direction: column;
                justify-content: flex-start;
                height: 500px;
                border: 1px solid black;
                border-radius: 10px;
                overflow-y: auto;
              "
              >
              </ul>
              <div
                      class="button_container"
                      style="
                display: flex;
                justify-content: center;
                gap: 30px;
                margin-top: 10px;
              "
              >
{#                  카테고리 이전 #}
                  <button type="button" id="prev-button">
                      <img
                              src="static/beforebutton.png"
                              height="50px"
                              width="50px"
                              alt="이전"
                      />
                  </button>
{#                  카테고리 다음#}
                  <button type="button" id="next-button">
                      <img
                              src="static/nextbutton.png"
                              height="50px"
                              width="50px"
                              alt="다음"
                      />
                  </button>
              </div>
          </div>

      </div>
      </div>
    </div>

    <script>
      const PAGE_SIZE = 10;
      const positive_reviews_list = {{ positive_reviews_list | safe }};
      const negative_reviews_list = {{ negative_reviews_list | safe }};

      let positivePageNumber = 0;
      let negativePageNumber = 0;

      const renderPage = (type) => {
        if (type === 'positive') {
          const reviewBox = document.querySelector('.positive_review_list');
          reviewBox.innerHTML='';
          for (let i = 0; i < PAGE_SIZE; i++) {
            const index = i + positivePageNumber * PAGE_SIZE;
            if (index < positive_reviews_list.length) {
              reviewBox.innerHTML += `<li style="padding: 10px; border: 1px solid lightgray">${positive_reviews_list[index]}</li>`;
            }
          }
        } else if (type === 'negative') {
          const reviewBox = document.querySelector('.negative_review_list');
          reviewBox.innerHTML='';
          for (let i = 0; i < PAGE_SIZE; i++) {
            const index = i + negativePageNumber * PAGE_SIZE;
            if (index < negative_reviews_list.length) {
              reviewBox.innerHTML += `<li style="padding: 10px; border: 1px solid lightgray">${negative_reviews_list[index]}</li>`;
            }
          }
        }
      };

      const positiveBeforeButton = document.querySelector(
        '#positiveBeforeButton'
      );
      const positiveNextButton = document.querySelector('#positiveNextButton');

      const negativeBeforeButton = document.querySelector(
        '#negativeBeforeButton'
      );
      const negativeNextButton = document.querySelector('#negativeNextButton');

      positiveBeforeButton.addEventListener('click', () => {
        if (positivePageNumber === 0) return;
        positivePageNumber--;
        renderPage('positive');
      });

      positiveNextButton.addEventListener('click', () => {
        if (positivePageNumber === positive_reviews_list.length / PAGE_SIZE - 1) return;
        positivePageNumber++;
        renderPage('positive');
      });

      negativeBeforeButton.addEventListener('click', () => {
        if (negativePageNumber === 0) return;
        negativePageNumber--;
        renderPage('negative');
      });

      negativeNextButton.addEventListener('click', () => {
        if (positivePageNumber === negative_reviews_list.length / PAGE_SIZE - 1) return;
        negativePageNumber++;
        renderPage('negative');
      });

      renderPage("positive");
      renderPage("negative");
    </script>

    <script>
        {#파이썬 변수를 자바스크립트 변수로 바꿈#}
        const positive_category_story = {{ positive_category_story | safe }};
        const positive_category_actor = {{ positive_category_actor | safe }};
        const positive_category_directing = {{ positive_category_directing | safe }};
        {#카테고리 버튼#}
        const story = document.getElementById('story');
        const actor = document.getElementById('actor');
        const directing = document.getElementById('directing');
        // 라디오 버튼처럼 동작
        // 세개중 하나만 선택할 수 있게 만들기
        const buttons = [story, actor, directing];

        {#왜 함수가 작동하지 않는거지 ...#}
        buttons.forEach(button => {
            button.addEventListener('click', (e) => {
              buttons.forEach(btn => {
                  btn.style.color = 'black';
              });

              // 카테고리 이동 시 페이지 초기화
              currentPage = 0;
              currentCategory = e.target.id;
              //  해당하는 애 출력하는 법?
              button.style.color = 'red';
              renderCategory(currentCategory);
            });
        });

        let currentPage = 0;
        let currentCategory = 'story';
        const reviewsPerPage = 10;

        const renderCategory = (type) => {
            if (type==='actor'){
                const reviewBox = document.querySelector('.category');
                {#기존리뷰 일단 지우기#}
                reviewBox.innerHTML = '';
                for (let i = 0; i < PAGE_SIZE; i++) {
                    const index = i + currentPage * PAGE_SIZE;
                    if (index < positive_category_actor.length) {
                        reviewBox.innerHTML += `<li style="padding: 10px; border: 1px solid lightgray">${positive_category_actor[index]}</li>`;
                    }
                }
            }
            else if (type === 'directing') {
                const reviewBox = document.querySelector('.category');
                reviewBox.innerHTML='';
                for (let i = 0; i < PAGE_SIZE; i++) {
                    const index = i + currentPage * PAGE_SIZE;
                    if (index < positive_category_directing.length) {
                        reviewBox.innerHTML += `<li style="padding: 10px; border: 1px solid lightgray">${positive_category_directing[index]}</li>`;
                    }
                }
            }
            else if (type === 'story') {
                const reviewBox = document.querySelector('.category');
                reviewBox.innerHTML='';
                for (let i = 0; i < PAGE_SIZE; i++) {
                    const index = i + currentPage * PAGE_SIZE;
                    if (index < positive_category_story.length) {
                        reviewBox.innerHTML += `<li style="padding: 10px; border: 1px solid lightgray">${positive_category_story[index]}</li>`;
                    }
                }
            }
        };

        // '다음' 버튼에 클릭 이벤트 리스너 추가
        document.getElementById('next-button').addEventListener('click', function() {
          // TODO: 마지막 페이지에서 더 안 넘어가도록 처리
          currentPage++;
          renderCategory(currentCategory);
        });

        // '이전' 버튼에 클릭 이벤트 리스너 추가
        document.getElementById('prev-button').addEventListener('click', function() {
            if (currentPage > 0) {
                currentPage--;
                renderCategory(currentCategory);
            }
        });

        // 초기 스토리 출력
        renderCategory('story');
        
        // 페이지 로드 시 스토리 카테고리 버튼이 선택되었다는 스타일 적용
        story.style.color = 'red';

    </script>
  </body>
</html>

